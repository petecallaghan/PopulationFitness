# PopulationFitness

## Java Version

1. Install the latest JDK: http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html
2. Install Maven (to build the Java project): https://maven.apache.org/install.html
3. To build the project run maven in the same directory as pom.xml (mvn)
4. The application has been developed using IntelliJ IDEA (https://www.jetbrains.com/idea/download)

### Building
To build using maven: 
* mvn package *Generates the JAR file (target\populationfitness.jar) after running all the tests*
* mvn package  -Dmaven.test.skip=true *Just generates the JAR file, without running tests*

### Running an Experiment
To run the main Java app:
* java -jar target/populationfitness.jar -s [seed] -t [csv file containing tuning] -e [csv file containing epochs]

For example:
* java -jar target\PopulationFitness.jar -s random -t Rosenbrock100.csv -e functionepochs-Rosenbrock-100.csv 

The *epoch* files are CSV format and can be generated by running methods from *uk.edu.populationfitness.tuning.TuneFunctionsTest*. An example is *functionepochs-SumOfPowers-100.csv*

The *tuning* files are CSV format, hand generated. Examples of tuning files include *sumsquarestuning.csv*

### Adding a new Fitness Function
Fitness functions are defined in *uk.edu.populationfitness.models.genes* as extensions of 
genes represented usually as *NormalizingBitSetGenes*. 

To add a new fitness function, create a new class that extends classes that derive from *BitSetGenes*. 

Then add an enumeration value to *uk.edu.populationfitness.models.genes.Function* and update
*uk.edu.populationfitness.models.genes.GenesFactory* to create a new instance of the new 
function for that enumeration value. 

Finally, tune first the fitness factor range and then generate the epochs CSV.   

### Tuning 
Tuning is a two-step process. For a new fitness function or new size of gene encoding you first have to 
check that the fitness function delivers values in a useful range within [0..1]. If the function is normalized, then 
its values should lie in this range.  

To check the fitness factor range for a fitness function, use *uk.edu.populationfitness.tuning.DiscoverFunctionRangeTest*. 

The fitness range is part of the tuning provided in the tuning CSV. Note that genes which derive from 
*NormalizingBitSetGenes* do not use the fitness range and must return fitness values from [0..1] without
range modification if they are to be usable. 

The next step is to generate the CSV that contains all the fitness factors for all the epochs. 

Use *uk.edu.populationfitness.tuning.DiscoverTuneFunctionsTest* to generate the CSVs.

###Multiple Runs
The application can run simulations in a variety of ways. 

1. As a single thread in a single process. The *tuning.csv* defines the number of runs in series and in parallel. 
A value of 1 (column 13) in series and 1 (column 14) in parallel will generate single population, written to a single output CSV file. 
2. As runs in series in a single thread in a single process. Define a value greater than 1 in series in
*tuning.csv* and 1 in parallel will generate multiple simulations one after the other, the results added 
together and written to a distinct CSV file after each simulation, culminating in a file called 
*allgenerations???????.csv*
3. As runs in series and multiple threads in a single process. Define a value greater than 1 in parallel 
(column 14 in *tuning.csv*). The app will generate multiple populations simultaneously in multiple threads
and add the results together into the *allgenerations????.csv* file at the end. 
4. As runs in series and multiple processes, optionally also on multiple threads in each of the processes. 
Each process interprets the *tuning.csv* file as for the options above. In addition, use the -c command 
line argument to define the java arguments of the child processes and the -p argument to define the number 
of child processes (eg *-c " -Xms8g -Xmx8g -jar target/populationfitness.jar" -p 2*). If the -p option is 
omitted but the -c option included, then the number of processes will be the same as the number of
parallel runs defined in the *tuning.csv*

###Disk Cache
The application uses a diskcache to avoid running out of memory. It generates temporary files that may need manually 
deleting. Look for files that start with "~".  

## Python Version

This version is now deprecated and should not be used. 

Install Python 3.x +

run 'pip install bitarray'

To run the tests:
1. Install pytest with the command: 'pip install pytest'
2. Set the root python path to current directory: 'set PYTHONPATH=.'
3. Run tests from the folder containing pytest.ini, eg: 'pytest test\\test_genes.py'

To run the main Python app:
1. py main.py
2. To add profiling run 'py -m cProfile main.py'


